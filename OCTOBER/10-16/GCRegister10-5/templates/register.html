{% extends "base.html" %}

{% block title %}Register Channel{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10 col-xl-8">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h2 class="h4 mb-0">üìù Channel Registration Form</h2>
            </div>
            <div class="card-body p-4">
                <p class="text-muted mb-4">
                    Fill out the form below to register your Telegram channels for the subscription payment system.
                    All fields are required.
                </p>

                <form method="POST" action="{{ url_for('register') }}" novalidate>
                    {{ form.hidden_tag() }}

                    <!-- Open Channel Section -->
                    <div class="section-divider mb-4">
                        <h3 class="h5 text-primary mb-3">üì¢ Open Channel Information</h3>
                        <p class="text-muted small">Your public channel where users can browse subscription options</p>

                        <div class="mb-3">
                            {{ form.open_channel_id.label(class="form-label fw-bold") }}
                            {{ form.open_channel_id(class="form-control" + (" is-invalid" if form.open_channel_id.errors else "")) }}
                            <div class="form-text">Your public channel's Telegram ID (e.g., -1001234567890)</div>
                            {% if form.open_channel_id.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.open_channel_id.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.open_channel_title.label(class="form-label fw-bold") }}
                            {{ form.open_channel_title(class="form-control" + (" is-invalid" if form.open_channel_title.errors else "")) }}
                            {% if form.open_channel_title.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.open_channel_title.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.open_channel_description.label(class="form-label fw-bold") }}
                            {{ form.open_channel_description(class="form-control" + (" is-invalid" if form.open_channel_description.errors else "")) }}
                            {% if form.open_channel_description.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.open_channel_description.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Closed Channel Section -->
                    <div class="section-divider mb-4">
                        <h3 class="h5 text-primary mb-3">üîí Closed Channel Information</h3>
                        <p class="text-muted small">Your premium channel with exclusive content for subscribers</p>

                        <div class="mb-3">
                            {{ form.closed_channel_id.label(class="form-label fw-bold") }}
                            {{ form.closed_channel_id(class="form-control" + (" is-invalid" if form.closed_channel_id.errors else "")) }}
                            <div class="form-text">Your premium channel's Telegram ID (e.g., -1001234567891)</div>
                            {% if form.closed_channel_id.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.closed_channel_id.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.closed_channel_title.label(class="form-label fw-bold") }}
                            {{ form.closed_channel_title(class="form-control" + (" is-invalid" if form.closed_channel_title.errors else "")) }}
                            {% if form.closed_channel_title.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.closed_channel_title.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.closed_channel_description.label(class="form-label fw-bold") }}
                            {{ form.closed_channel_description(class="form-control" + (" is-invalid" if form.closed_channel_description.errors else "")) }}
                            {% if form.closed_channel_description.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.closed_channel_description.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Subscription Tiers Section -->
                    <div class="section-divider mb-4">
                        <h3 class="h5 text-primary mb-3">üí∞ Subscription Pricing Tiers</h3>
                        <p class="text-muted small">Configure three subscription tiers (Bronze, Silver, Gold)</p>

                        <!-- Tier 1 -->
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h4 class="h6 mb-0">ü•â Tier 1 - Bronze</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        {{ form.sub_1_price.label(class="form-label fw-bold") }}
                                        {{ form.sub_1_price(class="form-control" + (" is-invalid" if form.sub_1_price.errors else "")) }}
                                        {% if form.sub_1_price.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.sub_1_price.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        {{ form.sub_1_time.label(class="form-label fw-bold") }}
                                        {{ form.sub_1_time(class="form-control" + (" is-invalid" if form.sub_1_time.errors else "")) }}
                                        {% if form.sub_1_time.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.sub_1_time.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tier 2 -->
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h4 class="h6 mb-0">ü•à Tier 2 - Silver</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        {{ form.sub_2_price.label(class="form-label fw-bold") }}
                                        {{ form.sub_2_price(class="form-control" + (" is-invalid" if form.sub_2_price.errors else "")) }}
                                        {% if form.sub_2_price.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.sub_2_price.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        {{ form.sub_2_time.label(class="form-label fw-bold") }}
                                        {{ form.sub_2_time(class="form-control" + (" is-invalid" if form.sub_2_time.errors else "")) }}
                                        {% if form.sub_2_time.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.sub_2_time.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tier 3 -->
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h4 class="h6 mb-0">ü•á Tier 3 - Gold</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        {{ form.sub_3_price.label(class="form-label fw-bold") }}
                                        {{ form.sub_3_price(class="form-control" + (" is-invalid" if form.sub_3_price.errors else "")) }}
                                        {% if form.sub_3_price.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.sub_3_price.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        {{ form.sub_3_time.label(class="form-label fw-bold") }}
                                        {{ form.sub_3_time(class="form-control" + (" is-invalid" if form.sub_3_time.errors else "")) }}
                                        {% if form.sub_3_time.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.sub_3_time.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Information Section -->
                    <div class="section-divider mb-4">
                        <h3 class="h5 text-primary mb-3">üè¶ Payment Information</h3>
                        <p class="text-muted small">Your cryptocurrency wallet details for receiving payouts</p>

                        <div class="mb-3">
                            {{ form.client_wallet_address.label(class="form-label fw-bold") }}
                            {{ form.client_wallet_address(class="form-control" + (" is-invalid" if form.client_wallet_address.errors else "")) }}
                            <div class="form-text">Your cryptocurrency wallet address (max 110 characters)</div>
                            {% if form.client_wallet_address.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.client_wallet_address.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.client_payout_currency.label(class="form-label fw-bold") }}
                            {{ form.client_payout_currency(class="form-select" + (" is-invalid" if form.client_payout_currency.errors else "")) }}
                            <div class="form-text">The cryptocurrency you want to receive as payment</div>
                            {% if form.client_payout_currency.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.client_payout_currency.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- CAPTCHA Section -->
                    <div class="section-divider mb-4">
                        <h3 class="h5 text-primary mb-3">üîê Security Verification</h3>

                        <div class="card bg-light mb-3">
                            <div class="card-body">
                                <p class="mb-2 fw-bold">{{ captcha_question }}</p>
                                {{ form.captcha(class="form-control" + (" is-invalid" if form.captcha.errors else ""), style="max-width: 200px;") }}
                                {% if form.captcha.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.captcha.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="d-grid">
                        {{ form.submit(class="btn btn-primary btn-lg") }}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Optional: Add client-side validation feedback
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        if (form) {
            form.addEventListener('submit', function(e) {
                const submitBtn = form.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Registering...';
                }
            });
        }
    });
</script>
{% endblock %}
